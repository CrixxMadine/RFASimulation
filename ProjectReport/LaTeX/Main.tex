
% Document type and layout
\documentclass[parskip=half, titlepage=yes, 12pt, BCOR=12mm, DIV=calc]{scrartcl}

% Praeambel = definition of layout and packages
\input{Praeambel}


\usepackage{amsthm}
\usepackage{lipsum}

%% Actual document
\begin{document}


% Title and registers
\maketitle
\tableofcontents

\clearpage

% \listoffigures
% \listoftables
% \lstlistoflistings
% \clearpage


% part 1, Introduction 

\section{Introduction to Radio Frequency Ablation}
Radio frequency ablation is a modern minimally invasive practice in surgery . In medicine it is mainly used to destroy human tissue. The two main areas of application are the medical treatment of tumours, as it destroys the malignant tissue, and also the treatment of chronic pain patients, as it can destroy nerve fibres that conduct pain signals to the brain. In the process, needles with electrodes are inserted into the patient. An external generator applies electricity and the heat generated by the electrodes increases the temperature of the tissue. The process is usually used in the temperature range of 70 to 100 degrees Celsius. A therapy session lasts for the patient from 20 minutes to several hours, depending on the need and case.
Radio Frequency Ablation (RFA) has been proven to be one of the best therapies for small tumors, which means areas smaller than 5 cm, in the human liver and kidney. The use of this treatment in modern medicine is increasing, as is the interest in research in this field. 
One of the largest branches of research is the simulation of such a therapy. Experimental research is usually based either on real patients or alternatively on animal organs such as the livers of pigs. Since experimental practice is generally very cumbersome, the interest in simulating such processes was there from the very beginning.  
With a stable and converging simulation model it is easier to try out different modifications and configurations of the process. Of course, these simulations are by no means a substitute for experimental practice, but they are a valuable addition to research. 
On a larger scale, the simulation of this process is used with virtual reality simulation programs to train physicians and surgeons in this process.

- For more information see TODO \
- TODO insert picture

This is the documentation of an academic approach to numerical finite element simulation. A model for the simulation of radio frequency ablation is used as the underlying time-dependent problem.
The main purpose of this project is to study the finite element method and its convergence behaviour in an academic setting, rather than to verify a realistic simulation of radio frequency ablation. 
The underlying RFA model is described as a three-dimensional coupled system of time-dependent partial differential equations. In this investigation the model is computed in 2D space with discrete time solutions. By modeling a single needle, the original 3D domain has a rotational symmetry around the needle. The rotationally symmetric 3D model can thus be described with 2D ring elements on a cross-section and special finite element techniques. 
All algorithms were implemented with the mathematical programming tool MatLab from MathWorks.


% part 2, Main

\section{Simulation of radio frequency ablation}

\subsection{Discrete Numerical Simulation}
Physical relations can usually be described by physical laws, which in turn can be described by mathematical relations. 
Usually, the descriptions represent highly complex systems, which in turn are described by ODEs, PDEs and statistics.
In real-world physics, these models are limited by boundary conditions that allow the calculation of certain solutions of the mathematical modeling. 
In most areas of physics, with the exception of quantum mechanics and modern theoretical physics, rough models can be formulated for which concrete solutions can be found. 
Since the physics of our world is determined to a certain degree, investigations can also be carried out with the help of computer-aided simulations instead of experiments and measurements. 
Properly performed simulations can be easily modified and adapted to different models and limits. \\

In practice, the geometric dimensions of most problem descriptions are very irregular.
In many cases, there is no reasonable analytical approach to solve these problems, especially in engineering applications.
To this end, more and more improved numerical methods have been developed in recent decades 
Instead of a smooth analytical solution, an approximation is calculated with sufficiently high accuracy.\\

- Finite difference method \\
- Finite element method \\
- TODO: most frequently used methods \\
- In this approach we will model radio frequency ablations with simple finite element techniques \\




\subsection{About Errors in simulations and numerical approaches}

The numerical simulation of physical processes leads along the whole process from the description of the real problem up to the discrete solution to various sources of error.

\begin{itemize}
    \item Idealization errors, the discrepancy between reality and idealized reality and idealized constitutive laws and boundary conditions. In reality, physical relationships are often much more complex than the mathematical assumptions and side effects are often neglected.
    \item Modelling errors, the discrepancy between mathematical formulation and physical model. Often physical assumptions in the mathematical description are represented by dimensionally reduced approaches, such as linear dependencies or invariant parameters.
    \item  Discretization errors: discrepancy between the continous description and discrete discription of the model TODO
    \item Solution errors: using iterative approximation methods and rounding errors  TODO \\
\end{itemize}


- It's basically a butterfly effect \\
- Optimizing one error source often conflicts with another one -> e.g. handling nonlinearity can cause fatal numerical errors (at least that's what Kroeger said ...)

For more information, see TUM Dissertation TODO add ref


\subsection{The physics behind radio frequency ablation}
- Needles stuck in tissue have electrodes with generate a potential \\
- Generating electrical energy by power of an extern generator \\
- Energy does not get lost \\
- Heats the tissue, temperature rises do to continuing energy input \\
- Generated heat is distributed on the tissue,  \\
- Thus additionaly there is a cooling effect by the perfusion of blood \\
- Heated tissue can kill harmful cells \\
- The whole process is regulated from outside \\

- Interesting for our simuation is: \\
- Temperature distribution over time \\
- What else? TODO \\

- For the simulation, we will use a RFA model as described following kroeger \\
- For simplicity, material parameters are seen constant \\
- In real world, material parameters are highly dependant on body conditions, temperature and vary heavily with different patients \\
- For some research to this topic, see Stein \\

- Electrical energy depends on the electrical power \\
- Power is defined by potential of the domain \\

\begin{equation}
    - \nabla \cdot (\sigma(x,y,z,t) \nabla \varphi(x,y,z,t)) = 0
\end{equation}

Power applied by the probe:

\begin{equation}
    p(x,y,z,t) = \sigma(x,y,z,t) \cdot |\nabla \varphi(x,y,z,t)|^2
\end{equation}

Due to tissue resistance, the effective power of the generater is obtained by a scaling. Thus can be modeled as following   

\begin{equation}
    Q_{rf} = p(x,y,z,t) \cdot \frac{p_{eff}(t)}{p_{total}(t)} 
\end{equation}

\begin{equation}
    p_{total}(t) = \int_{\Omega} p(x,y,z,t) dx
\end{equation}

\begin{equation}
    p_{eff}(t) = \frac{4 \cdot p_{setup} \cdot R_{tis}(t) \cdot R_I}{(R_{tis}(t) + R_I)^2}
\end{equation}

\begin{equation}
    R_{tis}(t) = \frac{U^2}{p_{total}(t)}
\end{equation}

$\sigma$ : electric conductivity \\
$\varphi = \varphi(x,y,z,t)$ : electric potential \\
$p \: = p(x,y,z,t)$  : power \\


$R_{tis}$ : tissue resistance \\
$R_I$ : inner resistance generator \\
$p_{setup}$ : setup power generator \\
$U$ : potential difference\\


- No energy is lost \\
- Electrical Energy becomes heat energy by Tissue resistance \\
- Heat Energy is distributed by heat equation \\

\begin{equation}
    \partial_t (\rho c T) - \nabla \cdot (\lambda \nabla T) = Q
\end{equation}

The heat equation is a well known parabolic partial differential equation. \\

We are assuming $\rho$ and $c$ are constant \\
$\rho$ : density \\
$c$ : specific heat capacity \\
$\lambda$ : thermal conductivity \\ %, which is depending on T \\
$\nu$ : perfusion coefficient \\
$T = T(x,y,z,t)$ : temperature \\
$Q = Q(x,y,z,t)$ : heat energy \\


- Additionaly to temperature destribution, there is the cooling effect of perfusion 

\begin{equation}
    Q_{total} = Q_{rf} + Q_{perf}
\end{equation}

- $Q_{rf}$ is descripted above \\
- $Q_{perf}$ is blood perfusion \\


\begin{equation}
    Q_{perf}(x,y,z,t) = \nu_{perf} \cdot \rho_{blood} c_{vlood} \cdot (T_{body} - T(x,y,z,t))
\end{equation}


- Discretization of the equation in space and time domain \\
- Time dependecy can be modeled continuously or in discrete intervalls \\
- Discrete intervalls are is typically more practical in modeling but less efficient or exact \\
- Discrete intervalls can be refined if necessary \\

- As described above, the whole simulation will be done on a 2D half section representing the 3D axis symmetric geometry \\ 


\section{Mathematical aspects of discrete simulation}

\subsection{Theory of finite elements}

\subsubsection{Elliptical problems}
- Elliptical problems in general \\
- build up system of PDE's to describe problem \\

- Ritz-Galerkin-Verfahren, for Details see ref book TODO \\
- This documentation will be focused on the 3D -> 2D aspect


- Using the cylindric domain, different domains, will be described later \\


\subsubsection{Assembling system of equations}
- Systems of equations by finite number of elements calculated with shape function \\
- solution is approximation of real solution \\

\begin{equation}
    Matrix
\end{equation}

\subsubsection{Boundary conditions}
- Dirichlet with trick, define value to be solution of variable \\
- TODO \\


- Neumann boundary with curve integral \\

\begin{equation}
    f = f_{vol} + f_{surf}
\end{equation}

\begin{equation}
    b = \int_{\Gamma_2} g \cdot \phi_{i} d S 
\end{equation}

- Note : In 2D dimension the surface integral is around the boundary line \\
- For natural boundary conditions $g(x) = 0$, the surface integral added is zero, which is a trivial solution \\

\subsubsection{Parabolic problems}
- Parabolic / time-dependent problems \\
- Usually involve an elliptic problem with additional time dependent factor \\

- Ignoring time dependency at first and calculate the resulting elliptical problem \\
- Build system of equations for elliptical problem \\

- Describe the parabolic PDE as an ODE with matrices from elliptical PDE \\
- Solving the system of ODE equations over discrete time intervalls \\
- Runge-Kutta \\
- For this simulation, backward euler / implicit euler formula does the job \\



\subsection{Axial symmetrie}
- In general, symmetrie should be used to reduce complexity whereever possible \\
- Using axial symmetrie allows to reduce the domain from a 3D problem to a 2D cross-section \\
- Thus this is to simplify and reduce time for computations \\
- In a truely axial symmetric domain, the problem on the cross-section is aquivalent, which will be shown later \\
- The allows significant savings on calculations time and complexity in general \\
- approach: fourier decomposition in angular direction to reduce dependency on the angular $\varphi$ \\

\begin{figure}[H]
    \centering
    \includegraphics[width=1.0\textwidth]{projection_2D_general.PNG}
    \caption{Schematic projection on 2D half section}
    \label{projection_2D_general}
\end{figure}


- TODO: write this more formal
- Lax-Milgram-Lemma and Poincaré inequality on 3D-Domain determine a unique solution \\
- $u \in H^{1}_{r}(\Omega) \cap \{ v|_{\Gamma_{0}} \}  $
- Trace-operator \\
- rotation axis becomes an artificial boundary on 2D half section \\

- A more formal description can be found in : \\
- Use input from article TODO \\


\section{Discretization of PDEs}

\subsection{Computational Domain}
- Using one needle, whole geometry domain is axis symmetric around one needle \\
- Problem can be reduced to 2D problem using ring elements and cylindric coordinates \\
- Eliminate dependency on angular $\phi$ from the calculations \\
- For visualisation, symmetric results can be reconstructed to 3D \\
- Whole calculation will be in cylindric coordinates \\

\subsection{FEM in cylindric Coordinates}
- Rewrite the equations to cylindric coordinates \\
- Calculations are made on a cross-section with angular phi = 0 \\
- Define boundaries -> new artificial boundary around the rotation axis to be taken into consideration \\
- Explain how the new boundary can be treated \\
 
Laplace in cartesian coordinates:
\begin{equation}
    \nabla^2 := \Delta := \frac{\partial^2}{\partial x^2} + \frac{\partial^2}{\partial y^2} + \frac{\partial^2}{\partial z^2}
\end{equation}

Laplace in cylindric coordinates:
\begin{equation}
    \Delta := \frac{\partial^2}{\partial r^2} + \frac{1}{r} \frac{\partial}{\partial r} + \frac{1}{r^2} \frac{\partial^2}{\partial \phi^2} + \frac{\partial^2}{\partial z^2}
\end{equation}

TODO \\

Laplace in polar coordinates:
\begin{equation}
    \Delta := \frac{\partial^2}{\partial r^2} + \frac{1}{r} \frac{\partial}{\partial r} + \frac{1}{r^2} \frac{\partial^2}{\partial \phi^2}
\end{equation}



\subsection{PDE for Electric potential}

\subsubsection{Discretization of the problem}
4 areas can be distinguished from a mathematical point of view \\
- Inner domain \\
- Fixed Potential of electrodes \\
- Outer boundaries with no fixed potential -> Robin \\
- Rotation axis, artificial boundary -> Neumann \\

Constant material parameters -> \\
Coefficients are constants \\
This will simplify calculations and coupling \\

\subsubsection{Inner Domain}

- The electric potential of the inner domain is described as : 

\begin{equation}
    - \nabla \cdot (\sigma(x,y,z,t) \nabla \varphi(x,y,z,t)) = 0
\end{equation}

- Elliptical boundary problem \\
- Assuming constant material parameters: $\nabla \sigma = 0$ \\
- Solution is independent from $\sigma$ so we can cut it out
- Equation becomes Laplaces' equation, phi becomes time independent \\

\begin{equation}
    - \Delta \varphi(x,y,z) = 0
\end{equation}

- Using a cylindric domain, it is preferred to change coordinate systems \\
- Axis symmetry is given cylindrical coordinates (see ref Laplace in cylinder)

\begin{equation}
    - \Delta \varphi(r,\phi,z) = - \frac{1}{r} \frac{\partial \varphi}{\partial r} - \frac{\partial^2 \varphi}{\partial r^2} - \frac{1}{r^2} \frac{\partial^2 \varphi}{\partial \phi^2} -      \frac{\partial^2 \varphi}{\partial z^2}  = 0
\end{equation}

- Since the domain has axis symmetry, the solution for $\varphi$ is independent from the angular $\phi$ \\
- So equation basically simplifies to 

% \begin{equation}
  %  - \Delta \varphi(r,\phi,z) \overset{!}{=} - \Delta \varphi(r,z) = - \frac{1}{r} \frac{\partial %\varphi}{\partial r} - \frac{\partial^2 \varphi}{\partial r^2} - \frac{\partial^2 \varphi}{\partial %z^2} = 0
% \end{equation}

\begin{equation}
    - \nabla  ( \sigma \cdot \nabla \varphi(r,\phi,z)) \overset{!}{=} - \Delta \varphi(r,z) = - \frac{1}{r} \frac{\partial \varphi}{\partial r} - \frac{\partial^2 \varphi}{\partial r^2} - \frac{\partial^2 \varphi}{\partial z^2} = 0
\end{equation}

To keep the following descriptions simple, we will (ignore) "verzichten" the explicit dependencies r and z, since this is trivial

\subsubsection{Electrodes}

- Potential difference on the electrodes is fixed by definition \\
- For calculations, potential will be defined as $\pm 1$ chosen arbitrarily \\
- Bipolar probes have one fixed potential at each electrode

\begin{equation}
    \varphi = \pm 1
\end{equation}

- Other values would be possible too, but are rather unusual at monopolar probes \\

\subsubsection{Outer boundary}

- An easy approach is a simplification with natural boundary conditions \\

\begin{equation}
    n \cdot \nabla \varphi = 0
\end{equation}

- In cylindrical coordinates
\begin{equation}
    TODO
\end{equation}

- In actual RFA treatment, there is a mass to nullify the potential in the outer regions \\
- For the lower boundary, this behaviour can be easily modeled with dirichlet conditions \\
\begin{equation}
    \varphi = 0
\end{equation}

- Neither the neumann nor the dirichlet conditions actually reflect physics properly,, but is rather accurate enough for this approach \\
- Since there are made other simplifications, especially with the unrealistic "Annahme" of constant material parameters, this simplification of boundary conditions is within the margin ob acceptable errors


\subsubsection{Rotation axis}

- this is an artificial boundary, as discribed above \\
- To keep the axis symmetry, "leicht einsehbar" that here must natural boundary conditions \\
- Other conditions would break the trace operator \\
- A more mathematical description for this "Annahme" will described in the following chapter

- \begin{equation}
    n \cdot \nabla \varphi = 0
\end{equation}



\subsection{Calculation of electrical energy}

- $\varphi$ can be calculated on every discrete point \\
- Calculate power for every point with equations above (TODO add ref here) \\
- Phi is evaluated on discrete mesh points \\
- In a nutshell, Tissue Resistance and nonlinear behaviour of the generator generate an effective power which is as well the total power of the domain  a scalar multiplication factor for every discrete value for phi \\

- Thus leading to the calculation of the electric energy from electric power above \\


\subsection{PDE for temperature Distribution}

\subsubsection{Discretization of the problem}

From physics above, the temperature distribution is modeled by the heat equation: 

\begin{equation}
    \partial_t (\rho c T) - \nabla \cdot (\lambda \nabla T) = Q
\end{equation}

The heat equation is a well known parabolic partial differential equation. \\

T = T(r,z,t) = temperature \\
Q = Q(r,z,t) = heat energy \\

The material parameters are taken as constant, as described above \\
$\rho$ = density \\
$c$ = specific heat capacity, \\
$\lambda$ = thermal conductivity \\
- In temperature range of radio frequency ablation, $c$ and $\lambda$ are especially nonlinear depending on the temperature, for which the phase change of water is reason to \\ Evaporated water has a totally different heat capacity and thermal conductivty, also the transition is smooth and not abrupt \\


- However, Modeling the phase change of water and corresponding heat capacity does in practise lead to big numerical problems \\

- It is reasonable to at least model the temperature dependency of lambda, which leads to the following description

Cylindrical coordinates: see 'Transient Heat Transfer in a Partially Cooled Cylindrical Rod' from Lawrence Agbezuge

\begin{equation}
    \rho c \frac{\partial T}{\partial t} -  \frac{d\lambda}{dT} \left[ \left( \frac{\partial T}{\partial r} \right)^2 + \left( \frac{\partial T}{\partial z} \right)^2 \right] - \lambda \left( \frac{\partial^2 T}{\partial r^2} + \frac{1}{r} \frac{\partial T}{\partial r} + \frac{\partial^2 T}{\partial z^2} \right) = Q
\end{equation}

- For sake of simplicity in this academic approach, we will ignore the phase change of water willingly as a whole \\

- So it is "good" to assume that $lambda$ would also be constant too, which greatly reduces the complexity of the whole PDE \\

\begin{equation}
    \rho c \frac{\partial T}{\partial t} - \lambda \left( \frac{\partial^2 T}{\partial r^2} + \frac{1}{r} \frac{\partial T}{\partial r} + \frac{\partial^2 T}{\partial z^2} \right) = Q
\end{equation}

- The right hand side is described in the physics, see ref\\
- It is depending on the generated electrical energy and the cooling effect of perfusion \\

\begin{equation}
    Q_{total} = Q_{rf} + Q_{perf}
\end{equation}

- Since the material parameters are constant, $Q_{perf}$ can be easily evaluated linear depending on T for every discrete time step \\

\subsubsection{Needle}

- If we assume that the probe is cooled from outside, it is as simple and also accurate assumption to take the body temperature as constant temperature for the probe over the whole intervall
\begin{equation}
    T = T_{body} \
\end{equation}

- Usually body temperature is around $\cong$ 37 degree Celsius or 310.15 degree Kelvin \\
- If the probe is not cooled, another simple approach is to model the behaviour of needle likewise as the outer boundary \\  

\subsubsection{Outer boundary}

- Assuming there is no "Disturbing" from outside, natural boundary conditions conditions are the correct assumption for the heat equation  

- \begin{equation}
    n \cdot \nabla \varphi = 0
\end{equation}

- These can also be used to model non cooled probes \\

- In the following, we will discribe how the PDE models for $\varphi$ and $T$ can be transformed in the context of finite elements and numerically evaluated at discrete points \\


\section{Applied FEM technologies}

\subsection{Weak solutions}
\subsubsection{Electric potential}

Electric potential / Laplace's equation in cylindrical domain:

\begin{equation}
    a_w(u,v) := \int_{\Omega} (\partial_r u \partial_r v + \partial_z u \partial_z v) r drdz = \int_{\Omega} f v r dr dz
\end{equation}

\begin{align}
    u \in H_r^1(\Omega) \cap \{v|_{\Gamma_{0}} = 0 \} \\
    v \in H_r^1(\Omega) \cap \{v|_{\Gamma_{0}} = 0 \}     
\end{align}


Specific PDE for electric potential, inner domain: 

\begin{equation}
    a_w(u,v) := \int_{\Omega} (\partial_r u \partial_r v + \partial_z u \partial_z v) r drdz = 0 
\end{equation}

\subsubsection{Temperature Distribution}

This is basically the problem above but as a hyperbolic problem \\
Using semidiscrete solution and iterate solution over time \\
We are applying method of the discontinuous galerkein fem \\
For reference see Jung, Langer : Methode der finiten Elemente für Ingenieure, chapter 7.1 \\



Weak formulation for the problem: \\

We are looking for $u(r,z,t) \in V_{g1}$ with $\Dot{u} \in L_2(\Omega)$ for almost every $t \in (0,T)$, so \\ \begin{equation}
(\Dot{u},v)_0 + a(t;u,v) = \langle F(t),v \rangle \; for \; all \; v \in V_0    
\end{equation}
and for amost every $t \in (0, T)$ is the "Anfangsbedingung -> suche englische Formulierung"
\begin{equation}
    (u(r,z,0),v)_0 = (u_0,v)_0 \; for \; all \; v \in V_0
\end{equation}

The formal model above is given by 
\begin{align*}
    (\Dot{u},v)_0 &= \int_{\Omega} \Dot{u}(r,z,t)v(r,z) drdz = \int_{\Omega} \frac{\partial u(r,z,t)}{\partial t} v(r,z) drdz, \\
    a(t;u,v) &= \int_{\Omega} \left[ \lambda_1(r,z,t) \frac{\partial u}{\partial r} \frac{\partial v}{\partial r} + \lambda_2(r,z,t) \frac{\partial u}{\partial z} \frac{\partial v}{\partial z} \right] \cdot r \cdot drdz + \int_{\Gamma_3} \alpha(r,z,t)u(r,z,t)v(r,z) ds, \\
    \langle F(t),v \rangle &= \int_{\Omega} f(r,z,t)v(r,z) drdz + \int_{\Gamma_2} g_2(r,z,t)v(r,z) ds + \int_{\Gamma_3} \alpha(r,z,t)u_A(r,z,t)v(r,z) ds, \\
    V_{g_1} &= TODO, \\
    V_0 &= TODO
\end{align*}

Adapted for the temperature distribution, assuming $\lambda$ and all material parameters are constant: 

\begin{equation}
    a_w(t;u,v) := \int_{\Omega} \rho c (\partial_t u \cdot v) r drdz + \int_{\Omega} \lambda (\partial_r u \partial_r v + \partial_z u \partial_z v) r drdz = \int_{\Omega} f v r dr dz
\end{equation}

\newpage


\subsection{Discretization / Triangulation}

- Grid generation and refinement \\
- 2D domain \\
- initial coarse grid trinagulation can be done by hand \\
- coarse grid can be refined by algorithm \\

- refinement of triangle into 4 new pieces \\
- \textcolor{blue}{insert picture here}

\subsection{Assembling system of equation}

- assemble elementwise \\
- Approximate elements with linear regression functions\\
- Calculation on reference triangles to speed up performance and accuracy \\

Linear regression functions for reference triangles:
\begin{align}
    \phi_1(\xi, \eta) &= 1 - \xi - \eta \\
    \phi_2(\xi, \eta) &= \xi \\
    \phi_2(\xi, \eta) &= \eta 
\end{align}

- use symmetrie of elements if coefficients are constant or allow it \\
- Add boundary conditions afterwards \\
- grouping of similar calculations allow more vectorized operations \\ 

\subsection{ODE for parabolic problems}

\textcolor{blue}{TODO}

\subsection{Solving the system of equations}
- direct solver would be preferred in general \\
- if numbers of element grows, this computations takes up lots of memory \\
- up from a certain point, high amount memory can't be efficiently handled with RAM anymore \\
- using additional memory is extremely costly in terms of calculation speed \\
- since matrix is sparse, iterative solver can be very fast \\
- iterative solver is preferred if elements grow in numbers \\
- TODO : when should you use iterative solver \\

\subsection{Error estimations}

\subsubsection{Element Error on 2D geometry}
- H1-Norm \\
- L2-Norm \\

- The analytical solution of the problem is unknown, but we can estimate it by calculating different element sizes on different sized fine grids \\

Idea: Define geometric some geometric coordinates on triangle and look for best matching or choose some points on different geometrical entities \\

Refine triangles around that point and see whether the error is smaller on the finer grid \\

\subsubsection{Time step error on discrete intervalls}

See Skript Numerik 2 Kroeger, after some take make a smaller or larger time step and compare the difference of results, use the smaller steps for calculation \\


\newpage


\section{Other numerical aspects }


\subsection{Surface integral}
- Sum of integral of every single triangle \\
- Single triangle on discrete gauss quadrature points \\
- Can use more nodes, which is usually worth the calculation effort \\
- Implemented on 3 or 7 points \\
- TODO insert picture \\

\subsection{Numerical gradient on discrete points}
- Trial functions approach the solution of the variation problem \\
- in our case, gradient is constant on every triangle \\
- actually discrete gradient on vertices is interesting \\
- vertices as average value of surrounding the sorrounding triangles \\

\subsection{Grid refinement}
- Refine triangle uniformly into 4 new ones \\
- Can be done as efficient vector operation \\

\subsection{Troublesome neighbours}
- Collision on corner nodes and boundaries of electrodes \\
- Corner node is defined well for dirichlet as well as for neumann conditions \\
- Handling dirichlet nodes is done by setting row and column vectores to zero and rhs to dirichlet value, which is a problem for the neumann boundary  \\
- Dirichlet value has higher priority for corners \\
- This is a problem for the node on the neumann boundary next to the corner \\
- So this exactly neumann node has some unforseen behaviour \\
- To handle this, best way has shown to be to ignore the result for this node and interpolate the result by weighing the neighboring nodes \\  
- This particular solution might have its obvious flaws, but gets pretty good results in practise \\




% < Section 7 Applied simulation >


\section{Applied simulation}
\subsection{Get reference data}
- Material parameters are obtained by Stein TODO make ref \\
- The mean concrete TODO Write down concrete parameters \\
- Using specification data from electrical generator \\
- Make ref for broschure TODO \\

\subsection{Solving the PDEs}

\subsection{Combine everything to continous time dependent simulation}
- Electric potential $\varphi$ and the elecrical energy $Q_{rf}$ are calculated in advance hence they are time independent \\ 


%\section{Programming technologies}
%
%\subsection{Performance Optimization}
%\subsection{MatLab vs C++}
%- Could have done the whole simulation using only MATLAB \\
%- MATLAB is a scripting language that calls Fortran Subroutines, which are highly efficient in %calculating problems of linear algebra \\
%- However, MATLAB has to call these subroutines in an efficient way to take these performance advantages %\\
%- It is extremely easy to write bad and inperformant code in MATLAB, if it is used in the wrong way \\
%- Efficient implementation required hardcoding routines and is very stiff \\ 
%- To me it was important to write flexible code, that can be easily adapted and extended to try out %different modification \\
%- This is way easier when using loops and subroutines instead of hard coded implementations, also the %code because way more easier to read and fix \\
%- So I was going for a combined implementation of MatLab and C++ \\ 
%- When using flexible code design, C++ allows performance advantages in using loops etc over MATLAB \\
%- However, MATLAB allows easy function hadnling, what makes the algorithms more accessable for the reader %\\ 
%- In the end I combined the advantages of both languages \\
%- MatLab serves as frame for the pre- and postprocessing, like grid generation and graphical output of %the numerical results. \\
%- Also the scripts serve as a mathematical documentation of the whole simulation for the reader \\
%- Computation intense subroutines are done in C++ \\


\subsection{Graphical output}
- 2D Data can be easily visualized on 3D plot \\
- 3D visualization can be obtained by recreation \\
- cross section solution is axis symmetric, so values apply for every angle $\phi$ \\
- From this a 3D Recreation can be obtained by defining concrete angular points \\
- Then retransformation into cartesian coordinates \\
- Plot on 3D geometry with color gradient to visualize differences in result data \\



% < Section 8 Numerical results >

\section{Numerical results}

%\begin{figure}[H]
%    \centering
%    \begin{minipage}{0.5\textwidth}[t]
%        \centering
%        \includegraphics[width=1.0\textwidth]{pictures/phi_2D_sideview.PNG}
%        \caption{TODO}
%        \label{phi_2D_sideview}
%    \end{minipage}%
%    \begin{minipage}{0.5\textwidth}[t]
%        \centering
%        \includegraphics[width=1.0\textwidth]{pictures/phi_2D_topview.PNG}
%        \caption{TODO}
%        \label{phi_2D_topview}
%    \end{minipage}
%\end{figure}

TODO reserved for Text \\

\begin{figure}[H]
    \centering
        \includegraphics[width=0.8\textwidth]{pictures/phi_2D_sideview.PNG}
        \caption{Time-independent numerical solution for $phi$ on a halved 2D cross-section}
        \label{phi_2D_sideview}
\end{figure}


\begin{figure}[H]
    \centering
        \includegraphics[width=0.8\textwidth]{pictures/phi_2D_topview.PNG}
        \caption{Topview of the solution for $\varphi$ on the halve grid}
        \label{phi_2D_topview}
\end{figure}



\begin{figure}[H]
    \centering
    \includegraphics[width=0.8\textwidth]{pictures/phi_3D.PNG}
    \caption{3D reconstruction of the numerical solution for $\varphi$}
    \label{phi_3D}
\end{figure}

- TODO reserved for text \\

\begin{figure}[H]
    \centering
    \includegraphics[width=0.9\textwidth]{pictures/temp_2D_240sec.PNG}
    \caption{Temperature distribution after 240 seconds on a coarse halved cross-section}
    \label{temp_2D_240sec}
\end{figure}


\begin{figure}[H]
    \centering
    \includegraphics[width=0.9\textwidth]{pictures/temp_2D_240sec_finer_full.PNG}
    \caption{Temperature distribution after 240 seconds on a fine grid}
    \label{temp_2D_240sec_finer_full}
\end{figure}


\begin{figure}[H]
    \centering
    \includegraphics[width=0.9\textwidth]{pictures/temp_3D_240sec_fine.PNG}
    \caption{3D reconstruction of the temperature distribution after 240 seconds}
    \label{temp_3D_240sec_fine}
\end{figure}



% < Section 9 Summary and outlook >

\section{Summary and outlook}

\subsection{Project Summary}
\subsubsection{A humble simulation}
One could argue, that it is a waste of time to write a numerical simulation from scratch. There are already many very useful software solutions for numerical simulations and these kind of problems in general. Therefore there is usually no need to write your own detailed implementation of the underlying algorithms. \\

However, creating your own scripts and implementations helps to understand numerical problems and sources of error in this type of modeling at all. Even all commercial software is based on algorithms of this kind. Dealing with these problems on one's own greatly improves the ability to use these software products effectively and write great simulations.\\

There can be no good software developer who does not understand how a computer processes numbers. Similarly, this academic approach trains the understanding of numerical simulation. I think, everybody who deals with finite elements should have implemented such algorithms himself at some point. \\

\subsubsection{Strengths and flaws}
It is appropriate at this point to draw a conclusion about the results achieved. \\
Basically the simulation can be regarded as quite good for a study project. 
The numerical results are in good agreement with the general expectation. The calculations converge relatively reliably with reasonable choice of variables.
The chosen implementation is flexible and can therefore easily be adapted to more complex approaches and models. \\
However, the chosen model is far too simplified to be a realistic representation of the conditions of an actual RFA treatment. Further planned modifications are interesting from a mathematical point of view, but would not significantly change the results of the simulation and thus its validity.


\subsubsection{Future modifications}
I plan to expand this project in the future and let the chosen model mature. The described material parameters are in reality strongly non-linearly dependent on the temperature and the surrounding factors. An improved parameterization of these should lead to much more realistic simulation results. Especially the evaporation of water and a more complex formulation of blood perfusion should be considered. Subsequently, more complex and more realistic boundary conditions should be chosen. 
The simulation of a second needle and monopolar probes would also be conceivable. The underlying algorithm can basically be adapted to three-dimensional problems.

%\subsection{State of the current Research}
%- Research in the simulation of medical therapy methods \\
%- TODO \\


\subsection{Other FEM software}

There is a lot of great commercial FEM software available to solve problems of this kind. Matlab, the tool used for this numerical simulation, offers its own PDE toolbox with corresponding libraries with efficient implementation of almost all aspects for solving partial differential equations.

In addition, there are numerous powerful simulation tools, which also offer additional features such as built-in geometric modelers and graphical user interfaces. COMSOL Multiphysics and ANSYS are two of the most widely used tools of their kind in modern industry.

Aside from that, there are a number of powerful free open source software projects that provide a number of highly optimized library functions. Worth mentioning here are the FEniCS project and FreeFEM.


\newpage


%% Literature register using .bib file
\clearpage
\nocite{*}
\printbibliography

\newpage

%% last part, appendix
% \appendix

% \input{Appendix} 

\end{document} 